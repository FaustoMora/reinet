{% extends "base.tpl.html" %}
{%block content%}

 
	<input type="hidden" value="{{concurso.idConcurso}}" id="hiddenid" />
    <div class="section-header">
      <div class="container">
        <div class="row">
          <div class="col-sm-12">
            <!-- Remove the .animated class if you don't want things to move -->
            <h1 class="animated slideInLeft"><span>Perfil Concurso</span></h1>
          </div>
        </div>
      </div>
    </div>

    <div class="container">        
    <div class="row">

      <!-- pop up de milestone-->
    <div id="blackscreen" class="detras ocultar"></div>
    <div id="miles" class="container centrado ocultar">
      
    </div>
    <!--Hasta AQUI-->



      <div class="col-sm-12">
        <div class="col-sm-8">
            <div class="col-sm-12">
              <h3>
                {{concurso.nombre}}
              </h3>
            </div>

            <div class="col-sm-12">
              <ul class="text-muted list-inline">
                <li><i class="fa fa-flag"></i> {{ concurso.estado }}</li>
                <li><i class="fa fa-user"></i> <a href="/verPerfil/?q={{concurso.idusuario}}">{{ concurso.idusuario }}</a></li>
              </ul>
            </div>
    

          <div class="col-sm-12" style="word-wrap: break-word;">        
          <p class="blog-text">
            <div class="col-md-3 col-sm-6">
              <div class="thumbnail">
                  <img src="/media/{{ concurso.imagen }} " class="img-responsive" alt="Concurso">
              </div>
            </div>
            {{ concurso.descripcion }} 
            <br /><br />
          </p>
          </div>
			
            <!-- Informacion general dominio,subdominio,disponibilidad, lugar de palicacion -->
            <div class="col-sm-12">
              <div class="block-header">
                <h2>
                  <span class="title">Informaci&oacute;n General</span><span class="decoration"></span><span class="decoration"></span><span class="decoration"></span>
                </h2>
              </div>
              <div class="col-sm-12">
                <table class="table">
                  <tbody>
                    <tr>
                      <td class="text-muted">Dominio</td>
                      <td colspan=4>{{ concurso.dominio }}</td>
                    </tr>
                    <tr>
                      <td class="text-muted">Subdominio</td>
                      <td colspan=4>{{ concurso.subdominio }}</td>
                    </tr>
                    <tr>
                      <td class="text-muted">Alcance</td>
                      <td colspan=4 style="position: relative; word-break:break-all;">{{ concurso.alcance }}</td>
                    </tr>
                    <tr>
                      <td class="text-muted">Fecha disponibilidad</td>
                      <td class="text-muted">Desde:</td>
                      <td>{{concurso.fecha_inicio}}</td>
                      <td class="text-muted">Hasta:</td>
                      <td>{{ concurso.fecha_fin}}</td>
                    </tr>
                  </tbody>
                </table>  
              </div>
            </div>

             <!-- Perfil del beneficiario  y del cliente-->
            <div class="col-sm-12" style="word-wrap: break-word;">
              <div class="block-header">
                <h2>
                  <span class="title">Otros</span><span class="decoration"></span><span class="decoration"></span><span class="decoration"></span>
                </h2>
              </div>
              <div class="col-sm-12">
                <table class="table" style="position: relative;">
                  <tbody style="position: relative;">
                    <tr>
                      <td class="text-muted" >Perfil</td>
                      <td >{{ concurso.perfil }}</td>
                    </tr>
                    <tr>
                      <td class="text-muted">Condiciones</td>
                      <td style="position: relative; word-break:break-all;">{{ concurso.condiciones }}</td>
                    </tr>
                    <tr>
                      <td class="text-muted">Tipo de Ofertas</td>
                      <td>{{ concurso.tipo_oferta }}</td>
                    </tr>
                    <tr>
                      <td class="text-muted">N&uacute;meros de Finalistas</td>
                      <td>{{ concurso.num_finalistas }}</td>
                    </tr>
                    <tr>
                      <td class="text-muted">Premios</td>
                      <td style="position: relative; word-break:break-all;">{{ concurso.premios }}</td>
                    </tr>
                    <tr>
                      <td class="text-muted">Estado</td>
                      <td>{% if concurso.estado == 1%} <p>Activo en convocatoria</p>{% endif %}</td>
                    </tr>
                  </tbody>
                </table>  
              </div>
            </div>


        </div>  

        <div class="col-sm-4">
          {% if val %}


                <div class="user-menu bottom-15">
                  <ul>
                    <li>
                      <a href="../editarConcurso/?q={{ concurso.idConcurso}}">
                        <i class="sign fa fa-edit bg-blue"></i> Editar Concurso <i class="fa fa-chevron-right pull-right"></i>
                      </a>  
                    </li>
                   
                  </ul>
                </div>


          {% endif %}
		  
		  <h4>Milestones : </h4>
		 <div class="timeline-block" >
          <!-- First blog post -->
          <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
          <input type="hidden" value="" id="miles_hidden">
		  {% for m in milestones%}
            <div class="blog-summary">
              {% if valinsc %}
                <h4><a href="#" id="openmiles{{m.idMilestone}}">Milestone {{m.peso}}</a></h4>
                
                <script>
                    $(document).ready(function(){
                      $(function(){
                        console.log("dentro del jquery")
                        $('#openmiles{{m.idMilestone}}').click(function(){
                          console.log("funcion click")
                          console.log({{m.idMilestone}})
                          $('#miles').addClass("container centrado mostrar");
                          $('#blackscreen').addClass("detras mostrar");
                          $('#miles_hidden').val("");

                          $.ajax({
                            type: "POST",
                            url: "/milesperfil/",
                            data: {
                            'csrfmiddlewaretoken' : $("input[name=csrfmiddlewaretoken]").val(),
                            'idmiles' : {{m.idMilestone}}
                            },
                            success: milesSuccess,
                            dataType: 'html'
                          });

                        });
                      });
                    });

                    function milesSuccess(data, textStatus, jqXHR){
                      $('#miles').html(data);
                    }
                </script>
                {% else %}
                    <h4 style="color:blue">Milestone {{m.peso}}</h4>
                {% endif %}

              <time datetime="2013-11-10" class="timestamp hidden-xs">{{ m.fecha_entrega }}</time>
              <ul class="text-muted list-inline">
                <li><i class="fa fa-user"></i> {{ concurso.idusuario }}</li>
                <li><i class="fa fa-calendar"></i> {{ m.fecha_entrega }}</li>
              </ul>
              <hr>
              <p class="blog-text">
                {{ m.requerimiento }} 
              </p>
            </div>
			{% endfor %}
			<!--End mile -->
           
          </div>
		  {% csrf_token %}
		  
		  {% if val2 %}
			<button id="insOf" class="btn btn-blue">Inscribir Oferta</button>
		  {% endif %}	
		  <div id="showOf">
		  
		  </div>
		
		  {% if val2 == False %}
			{% if inscrip.count > 0 %}
				<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
				<h4>Solicitudes de Ofertas </h4>
				{%for i in inscrip%}
					<div id="panel{{i.idInscripcion}}" class="panel panel-red">
					  <div class="panel-heading">
						<h3 class="panel-title">{{ i.idOferta.nombre }}</h3>
					  </div>
					  <div class="panel-body">
						{{ i.idOferta.descripcion }}<br/>
						Fecha de Inscripci&oacute;n: {{ i.fecha }}<br/>
						<input type="hidden" value="{{i.idInscripcion}}" id="{{i.idInscripcion}}">
						<button class="btn btn-default" id="Accept{{i.idInscripcion}}">Aceptar</button>
						
						<button class="btn btn-default" id="Denie{{i.idInscripcion}}">Rechazar</button>
						
						<script>

							$(document).ready(function() {
								$(function(){
									$('#Accept{{i.idInscripcion}}').click(function(){
										$.ajax({
											type: "POST",
											url: "/gestionarInscripcion/",
											data: {
												'csrfmiddlewaretoken' : $("input[name=csrfmiddlewaretoken]").val(),
												'idinscrip' : {{i.idInscripcion}},
												'value' : 1
											},
											
											dataType: 'html'
										});
										$('#panel{{i.idInscripcion}}').remove();
									});
								});
							});



							$(document).ready(function() {
								$(function(){
									$('#Denie{{i.idInscripcion}}').click(function(){
										$.ajax({
											type: "POST",
											url: "/gestionarInscripcion/",
											data: {
												'csrfmiddlewaretoken' : $("input[name=csrfmiddlewaretoken]").val(),
												'idinscrip' : {{i.idInscripcion}},
												'value' : 2
											},
											
											dataType: 'html'
										});
										$('#panel{{i.idInscripcion}}').remove();
									});
								});
							});


						</script>
					  </div>
					</div>
				{% endfor %}
			{% endif %}
		  {% endif %}
			
			
		   
			{% if participantes.count > 0 %}
			<h4>Ofertas Participantes</h4>
				{%for p in participantes%}
					<div id="panel{{i.idInscripcion}}" class="panel panel-blue">
					  <div class="panel-heading">
						<h3 class="panel-title">{{ p.idOferta.nombre }}</h3>
					  </div>
					  <div class="panel-body">
						{{ p.idOferta.descripcion }}<br/>
						Creador de la Oferta: {{ p.idOferta.idusuario }}<br/>
						<!--<input type="hidden" value="{{i.idInscripcion}}" id="{{i.idInscripcion}}">-->
					  </div>
					</div>
				{% endfor %}
			{% endif %}
			
      </div>
      
    </div>
  </div>
</div>
{% endblock %}